{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/posts/2023-01-01---Next-generation-ORM-Prisma","result":{"data":{"markdownRemark":{"id":"0fe473cc-7b57-510e-8ed3-ab66447c0a70","html":"<ul>\n<li><a href=\"#next-generation-orm-prisma\">Next-generation ORM：Prisma</a></li>\n<li><a href=\"#what-is-prisma\">What is Prisma?</a></li>\n<li><a href=\"#why-prisma\">Why Prisma ?</a></li>\n</ul>\n<h2 id=\"next-generation-ormprisma\" style=\"position:relative;\"><a href=\"#next-generation-ormprisma\" aria-label=\"next generation ormprisma permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next-generation ORM：Prisma</h2>\n<p>經常寫 Node 應用程式的人通常免不了要和 ORM 打交道，畢竟寫原生 SQL 對於大部分的人會比較複雜也或許情境不需要用到這樣的原生操作。ORM 的便利性使得很多情況下我們能直觀而快速地取得資料庫的資料。</p>\n<h2 id=\"what-is-prisma\" style=\"position:relative;\"><a href=\"#what-is-prisma\" aria-label=\"what is prisma permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is Prisma?</h2>\n<p>Prisma 是開源程式，是在 NodeJS 社群中的 ORM，老牌的 ORM 像是 TypeORM、MikroORM 或是 MongoDB 專用的 ORM mongoose。</p>\n<p>Web 的應用開發過程中，需要花費大量時間與關連式資料庫操作，需要花很多時來調適 SQL 查詢語句，Prisma 則是提供一套簡潔的 API，可以更加方便操作資料庫，不僅提供了操作資料庫的 API，還可以依照需求，透過工具組合來建構 Rest API 或是 GraphQL，支援了多種資料庫串接，包含 PostgreSQL, MySQL, SQLite, MongoDB, CrockoachDB 與 MSSQL 。</p>\n<p>包含了以下</p>\n<ul>\n<li><strong>Prisma Client：Auto-generated and type-safe query builder for Node.js &#x26; TypeScript</strong></li>\n<li><strong>Prisma Migrate：Migration system</strong></li>\n<li><strong>Prisma Studio： 資料庫的 GUI 介面</strong></li>\n</ul>\n<h2 id=\"why-prisma\" style=\"position:relative;\"><a href=\"#why-prisma\" aria-label=\"why prisma permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why Prisma?</h2>\n<ol>\n<li><strong>Thinking in objects instead of mapping relational data</strong></li>\n<li><strong>Queries not classes to avoid complex model objects</strong></li>\n<li><strong>Single source of truth</strong> for database and application models</li>\n<li><strong>Healthy constraints</strong> that prevent common pitfalls and antipatterns</li>\n<li><strong>An abstraction that makes the right thing easy</strong></li>\n<li><strong>Type-safe database queries</strong> that can be validated at compile time</li>\n<li><strong>Auto-completion in code editors</strong> instead of needing to look up documentation</li>\n</ol>\n<h2 id=\"orm-object-relational-mapping\" style=\"position:relative;\"><a href=\"#orm-object-relational-mapping\" aria-label=\"orm object relational mapping permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ORM( Object Relational Mapping)</h2>\n<p>資料庫與程式之間做了一層對應，與資料庫的語法都是使用 ORM 的語法，ORM 換轉換成 SQL 去執行，所以在操作上並非直接去寫原始的 SQL。</p>\n<p><strong>原始 SQL：完全控制，生產率低</strong></p>\n<p>可以完全對資料庫發送純 SQL 字符串，才操作資料庫，但直接下 SQL 指令很麻煩，並且會帶來大量的開銷，所以對程式的生產力降低。</p>\n<p><strong>SQL 查詢構建器(SQL query builders)：高控制，中等生產力</strong></p>\n<p>保留高控制並提供更高生產力的常見解決方案是使用 SQL 查詢構建器，像是 knex.js，仍然需要根據 SQL 來存取資料，還是會有將關係資料轉換成物件對象的成本。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6669817e16004ac8d4fb0c213321a228/d4e7f/prisma6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.583333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8klEQVQoz6WRy4rDMAxF/R2t37b8SpyWTruZ//+vO0gQyCJQwiyOJLB1dWWr7D0Wqhi5YFaP6CycvsMbfQnu4V7FYVsWPPvEo3cEay4L7vc5Kxb4vF+YbeA1nv9yyFkFZ+GtRdAGwZy7uzJAFacxyYNqQs5Bmq2+Sf4mdHauOHxawM9a0HpFSVHIwQu78BmnDoPRyN4I/H4peiTPOETv5JOYvYFrvse1vd+E4xBFzuB3Jrw3Ql8bRs/otWBbBtbesLSKx1ylZuboeG4ToxbUnNAog2IQxKHVGiNarBRAKaJTRiska/dCsjZn5uiUYafMcYs/9QD3y9HYowAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6669817e16004ac8d4fb0c213321a228/8ac56/prisma6.webp 240w,\n/static/6669817e16004ac8d4fb0c213321a228/d3be9/prisma6.webp 480w,\n/static/6669817e16004ac8d4fb0c213321a228/e46b2/prisma6.webp 960w,\n/static/6669817e16004ac8d4fb0c213321a228/3437f/prisma6.webp 1416w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6669817e16004ac8d4fb0c213321a228/8ff5a/prisma6.png 240w,\n/static/6669817e16004ac8d4fb0c213321a228/e85cb/prisma6.png 480w,\n/static/6669817e16004ac8d4fb0c213321a228/d9199/prisma6.png 960w,\n/static/6669817e16004ac8d4fb0c213321a228/d4e7f/prisma6.png 1416w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6669817e16004ac8d4fb0c213321a228/d9199/prisma6.png\"\n            alt=\"prisma6\"\n            title=\"prisma6\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><strong>ORM：更少的控制，更高的生產力</strong></p>\n<p>ORM 存在主要是為了替程式設計師架起資料庫中間的橋樑，可以達到更有效的訪問。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ff9c8618fde6abf539a53712c4ddb9ce/2215f/prisma5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABaUlEQVQ4y5WTyXLCMBBE+f9vyyEkUARvWmazgUoOnHLqlOQFA3ZSObRHVZKeu6XRRlVBxAiRkMYikut8nGokArM8rXnUZg2Y6jh2PuBt/4HDsbybXwfyMlA1QRUxEnyIWWnt4w//ARw3Kk6qaLMM9qfDx8gJkhfI5ORw7lCr4uA9GqLV2Jt00LULd8AMy9XAYlDr8P55RmmKnXOoiCaXc/VAEVSNX3Bo+FSHsziIK9AxDZH1FnkRyIKidovAq1X44gJyfIWQ753b0FJq0Cydatq7SZ/Gx6fIfW3BahBrB0iL62WHi+xA1RbcbMH1FlS+gN0+g/OlJJd3wPk5TnH62+46gSlByA0KvXum9bb5TcQCtt61tN3gfhZ5BKbmNdPVJ5UvQhUnM3yHgJN3sKJAW5bDmfdnPwEbHxCHfhwVF8YUGScfQM7DnIN5f+vbEZijEN+UHBOjbgKKyk1PbpwPLIgskBzdZn2r+AGWfwRRTochcAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ff9c8618fde6abf539a53712c4ddb9ce/8ac56/prisma5.webp 240w,\n/static/ff9c8618fde6abf539a53712c4ddb9ce/d3be9/prisma5.webp 480w,\n/static/ff9c8618fde6abf539a53712c4ddb9ce/e46b2/prisma5.webp 960w,\n/static/ff9c8618fde6abf539a53712c4ddb9ce/f992d/prisma5.webp 1440w,\n/static/ff9c8618fde6abf539a53712c4ddb9ce/10263/prisma5.webp 1548w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ff9c8618fde6abf539a53712c4ddb9ce/8ff5a/prisma5.png 240w,\n/static/ff9c8618fde6abf539a53712c4ddb9ce/e85cb/prisma5.png 480w,\n/static/ff9c8618fde6abf539a53712c4ddb9ce/d9199/prisma5.png 960w,\n/static/ff9c8618fde6abf539a53712c4ddb9ce/07a9c/prisma5.png 1440w,\n/static/ff9c8618fde6abf539a53712c4ddb9ce/2215f/prisma5.png 1548w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ff9c8618fde6abf539a53712c4ddb9ce/d9199/prisma5.png\"\n            alt=\"prisma5\"\n            title=\"prisma5\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"特點\" style=\"position:relative;\"><a href=\"#%E7%89%B9%E9%BB%9E\" aria-label=\"特點 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>特點</h3>\n<ol>\n<li>Schema 定義，我們所認識的 ORM 都是使用 JS/TS 進行定義的，而 Prisma 則使用<code class=\"language-text\">.prisma</code> 文件來撰寫表的結構，以下用 Sequelize 與 Prisma model 的示例</li>\n</ol>\n<p><strong>Sequelize model</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Model</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\nUser<span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">user_id</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token constant\">INTEGER</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">primaryKey</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">autoIncrement</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token constant\">STRING</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">email</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token constant\">STRING</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">unique</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">isAdmin</span><span class=\"token operator\">:</span> Sequelize<span class=\"token punctuation\">.</span><span class=\"token constant\">BOOLEAN</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> sequelize<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">modelName</span><span class=\"token operator\">:</span> <span class=\"token string\">\"user\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>Prisma Schema model</strong></p>\n<p>簡單的 prisma 定義如下</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">model User <span class=\"token punctuation\">{</span>\n  user_id Int     @id @<span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token function\">autoincrement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  name    String<span class=\"token operator\">?</span>\n  email   String  @unique\n  isAdmin Boolean @<span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li>Typescript 類型定義更加全面，包含查詢參數、操作符參數、級聯參數、返回結果等。</li>\n<li>更加全面的操作符 contains、startsWith、endsWith</li>\n<li>全面的工具涵蓋資料庫的流程\n<ol>\n<li>querying （<a href=\"https://www.prisma.io/docs/concepts/components/prisma-client\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Prisma Client</a>）</li>\n<li>data modeling (<a href=\"https://www.prisma.io/docs/concepts/components/prisma-schema\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Prisma schema</a>)</li>\n<li>migrations (<a href=\"https://www.prisma.io/docs/concepts/components/prisma-migrate\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Prisma Migrate</a>)</li>\n<li>prototyping via prisma db push</li>\n<li>seeding via prisma db seed</li>\n<li>visual viewing and editing （with <a href=\"https://prisma.io/studio\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Prisma Studio</a>）</li>\n</ol>\n</li>\n</ol>\n<hr>\n<h3 id=\"quick-start\" style=\"position:relative;\"><a href=\"#quick-start\" aria-label=\"quick start permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Quick start</h3>\n<p>Node.js version 14.17.0 or higher</p>\n<p>Access to a MongoDB 4.2+</p>\n<h3 id=\"set-up-package-environment\" style=\"position:relative;\"><a href=\"#set-up-package-environment\" aria-label=\"set up package environment permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Set up package environment</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 初始化專案\nnpm init -y\nnpm install prisma typescript ts-node @types/node --save-dev\n\n# Prisma CLI\nnpx prisma\nnpx prisma init</code></pre></div>\n<p><code class=\"language-text\">tsconfig.json</code></p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"compilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"sourceMap\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"outDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dist\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"strict\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lib\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"esnext\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"esModuleInterop\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"connect-to-db\" style=\"position:relative;\"><a href=\"#connect-to-db\" aria-label=\"connect to db permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Connect to DB</h3>\n<p>在<code class=\"language-text\">.env</code>檔案裡修改連接資訊</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">DATABASE_URL = 'mongodb://localhost:27017/prisma';</code></pre></div>\n<h3 id=\"set-up-schema\" style=\"position:relative;\"><a href=\"#set-up-schema\" aria-label=\"set up schema permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Set up schema</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">generator client <span class=\"token punctuation\">{</span>\n  provider <span class=\"token operator\">=</span> <span class=\"token string\">\"prisma-client-js\"</span>\n<span class=\"token punctuation\">}</span>\n\ndatasource db <span class=\"token punctuation\">{</span>\n  provider <span class=\"token operator\">=</span> <span class=\"token string\">\"mongodb\"</span>\n  url      <span class=\"token operator\">=</span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DATABASE_URL\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nmodel Post <span class=\"token punctuation\">{</span>\n  id       String    @id @<span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token function\">auto</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> @<span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">)</span> @db<span class=\"token punctuation\">.</span>ObjectId\n  slug     String    @unique\n  title    String\n  body     String\n  comments Comment<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  author   User      @<span class=\"token function\">relation</span><span class=\"token punctuation\">(</span>fields<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>authorId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">references</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  authorId String    @db<span class=\"token punctuation\">.</span>ObjectId\n<span class=\"token punctuation\">}</span>\n\nmodel Comment <span class=\"token punctuation\">{</span>\n  id      String @id @<span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token function\">auto</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> @<span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">)</span> @db<span class=\"token punctuation\">.</span>ObjectId\n  post    Post   @<span class=\"token function\">relation</span><span class=\"token punctuation\">(</span>fields<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>postId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">references</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  postId  String @db<span class=\"token punctuation\">.</span>ObjectId\n  comment String\n<span class=\"token punctuation\">}</span>\n\nmodel User <span class=\"token punctuation\">{</span>\n  id    String  @id @<span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token function\">auto</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> @<span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">)</span> @db<span class=\"token punctuation\">.</span>ObjectId\n  email String  @unique\n  name  String<span class=\"token operator\">?</span>\n  posts Post<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a8dd2c2bb141d2cc4ddccaea4d958d0d/52ab5/prisma4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.083333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABSklEQVQoz6WQWW/jMAyE8///XpttH9qsD1k+ctiBZevWV0hGF3lfAQMNh+KQ1CmEyLwsPB4z83zc/3NOIQRa0fF9qaiqBiEk66rQWrPtO1ob9l2j1FY0tW1s286+H1iVKvlda7JXMbzd7vTDWIzH6UrXSeqmpe9HpOxpW1HinK/qFikHmrajkz11IwpyLjcthrIfaIRkut0xxmCdQxuLDxHnPMZanHNY6w7ufeFZy/WZ5+m995yOzRPJGPDuNwRnSTZrFoIvcnQWYijch1CMM8r73z8s9THi6hpXN7h9xo5/MPIN058x/XuBnWvM85OH6vhcBef5wsez4rz85W2+cLVLMT4ME/hhwI8T3ij8OuKWDjN94Z4Sryb89sAqwWoWRrPQbVe+FkG7jvT6ztOplwlTIuUVQ/g3em4S88ovJ7yul0BbQ4zxpSbxA86bafUaoS82AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a8dd2c2bb141d2cc4ddccaea4d958d0d/8ac56/prisma4.webp 240w,\n/static/a8dd2c2bb141d2cc4ddccaea4d958d0d/d3be9/prisma4.webp 480w,\n/static/a8dd2c2bb141d2cc4ddccaea4d958d0d/e46b2/prisma4.webp 960w,\n/static/a8dd2c2bb141d2cc4ddccaea4d958d0d/9427e/prisma4.webp 1420w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a8dd2c2bb141d2cc4ddccaea4d958d0d/8ff5a/prisma4.png 240w,\n/static/a8dd2c2bb141d2cc4ddccaea4d958d0d/e85cb/prisma4.png 480w,\n/static/a8dd2c2bb141d2cc4ddccaea4d958d0d/d9199/prisma4.png 960w,\n/static/a8dd2c2bb141d2cc4ddccaea4d958d0d/52ab5/prisma4.png 1420w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a8dd2c2bb141d2cc4ddccaea4d958d0d/d9199/prisma4.png\"\n            alt=\"prisma4\"\n            title=\"prisma4\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"install-prisma-client\" style=\"position:relative;\"><a href=\"#install-prisma-client\" aria-label=\"install prisma client permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install Prisma Client</h3>\n<p>用來操作資料庫的 prisma 套件</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">npm install @prisma/client</code></pre></div>\n<p>install command automatically invokes <strong><code class=\"language-text\">prisma generate</code></strong></p>\n<p>如果有更改表的結構，需要先執行<code class=\"language-text\">prisma generate</code> 讓 Prisma Client 可以對應到 model。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/05b7fff4ebae3a2eb8214047b990daba/322c5/prisma3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB8UlEQVQoz42S20sUYRiH9w/upqAiOwihkniItAUPlYEVdNmFYCSi4pqru7q64257mJ35zjPOzqz1DzwxI4IXEV48/PhePh5+vLwlay2tdgelFDYIML5fYD2PoZSkUvHHWVIlGQpRzOxgUPy5FIIoDLC+z+raV47rDUpaG04bTcJQYHOpFFitcL0uqRSFpF6p4nyfTEoSpTBK4bTm+KhOp93BacXswnsqhzVKQkga5xf0+gNMv8Vl/5yrKGBk+4yiEOF3eT61iNfuEidDtIsx1pEkCQvL62z+2CXNUubLHzmo1igZYwhCgdIaa3TR7iYjZxFCMDGzROusiu7VCNp1hN8mtgHllXW+b+2RpgmzCx84yBvmO3TOkqe5jclnrtjtoxczNJsesRog+xcYJUliR3nlE5tbu2TZkInZJfYPjq8b3mBvkb+dtYXw/pNX1M+bDJwi0ApfCtxlxNTcMhub24yylMm55Wth3uxf3BY+GJumetagawZ0Q59fQR8VG55NvuHbxhZXVxnjU4vsVap3FD6dxvNaZElCZC2xs4zSIUvvvrC9U+H3KGXs5Wt29w/vJrz3cILqiYe0MZ3QcNLVtHxFL9T4wjBQjsfjc+zs/fy/ME+tNfNv1/Dye4sipDaEyiCUQWmDMrY4o/LqZ45qp/wFsca8wz86H8wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/05b7fff4ebae3a2eb8214047b990daba/8ac56/prisma3.webp 240w,\n/static/05b7fff4ebae3a2eb8214047b990daba/d3be9/prisma3.webp 480w,\n/static/05b7fff4ebae3a2eb8214047b990daba/e46b2/prisma3.webp 960w,\n/static/05b7fff4ebae3a2eb8214047b990daba/f992d/prisma3.webp 1440w,\n/static/05b7fff4ebae3a2eb8214047b990daba/882b9/prisma3.webp 1920w,\n/static/05b7fff4ebae3a2eb8214047b990daba/acf52/prisma3.webp 2286w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/05b7fff4ebae3a2eb8214047b990daba/8ff5a/prisma3.png 240w,\n/static/05b7fff4ebae3a2eb8214047b990daba/e85cb/prisma3.png 480w,\n/static/05b7fff4ebae3a2eb8214047b990daba/d9199/prisma3.png 960w,\n/static/05b7fff4ebae3a2eb8214047b990daba/07a9c/prisma3.png 1440w,\n/static/05b7fff4ebae3a2eb8214047b990daba/29114/prisma3.png 1920w,\n/static/05b7fff4ebae3a2eb8214047b990daba/322c5/prisma3.png 2286w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/05b7fff4ebae3a2eb8214047b990daba/d9199/prisma3.png\"\n            alt=\"prisma3\"\n            title=\"prisma3\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"create-and-query-users\" style=\"position:relative;\"><a href=\"#create-and-query-users\" aria-label=\"create and query users permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create and query users</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> PrismaClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@prisma/client\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> prisma <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">PrismaClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">await</span> prisma<span class=\"token punctuation\">.</span><span class=\"token function\">$connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">await</span> prisma<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Rich\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">email</span><span class=\"token operator\">:</span> <span class=\"token string\">\"hello@prisma.com\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">posts</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">create</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">\"My first post\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Lots of really interesting stuff\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">slug</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my-first-post\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> allUsers <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> prisma<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">findMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>allUsers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">await</span> prisma<span class=\"token punctuation\">.</span><span class=\"token function\">$disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">await</span> prisma<span class=\"token punctuation\">.</span><span class=\"token function\">$disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"prisma-migration\" style=\"position:relative;\"><a href=\"#prisma-migration\" aria-label=\"prisma migration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prisma Migration</h3>\n<p>Migration 是用來描述資料庫結構是什麼樣子，會隨著專案開發中逐漸增加，使用 Migration 進入版本控制後，整個資料庫的設計過程一目瞭然，方便一起協作。</p>\n<ol>\n<li>建立好資料結構後</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">generator client <span class=\"token punctuation\">{</span>\n  provider <span class=\"token operator\">=</span> <span class=\"token string\">\"prisma-client-js\"</span>\n<span class=\"token punctuation\">}</span>\n\ndatasource db <span class=\"token punctuation\">{</span>\n  provider <span class=\"token operator\">=</span> <span class=\"token string\">\"sqlserver\"</span>\n  url      <span class=\"token operator\">=</span> <span class=\"token function\">env</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"DATABASE_URL\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\nmodel Post <span class=\"token punctuation\">{</span>\n  id        Int      @id @<span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token function\">autoincrement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  createdAt DateTime @<span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  updatedAt DateTime @updatedAt\n  title     String   @db<span class=\"token punctuation\">.</span><span class=\"token function\">VarChar</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span>\n  content   String<span class=\"token operator\">?</span>\n  published Boolean  @<span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n  author    User     @<span class=\"token function\">relation</span><span class=\"token punctuation\">(</span>fields<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>authorId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">references</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  authorId  Int\n<span class=\"token punctuation\">}</span>\n\nmodel Profile <span class=\"token punctuation\">{</span>\n  id     Int     @id @<span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token function\">autoincrement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  bio    String<span class=\"token operator\">?</span>\n  user   User    @<span class=\"token function\">relation</span><span class=\"token punctuation\">(</span>fields<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>userId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">references</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  userId Int     @unique\n<span class=\"token punctuation\">}</span>\n\nmodel User <span class=\"token punctuation\">{</span>\n  id      Int      @id @<span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token function\">autoincrement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  email   String   @unique\n  name    String<span class=\"token operator\">?</span>\n  posts   Post<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  profile Profile<span class=\"token operator\">?</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li>執行第一次的 migration</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">prisma migrate dev --name init</code></pre></div>\n<ol start=\"3\">\n<li>結果顯示</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Applying migration `20220803160039_init`\n\nThe following migration(s) have been created and applied from new schema changes:\n\nmigrations/\n  └─ 20220803160039_init/\n    └─ migration.sql</code></pre></div>\n<ol start=\"4\">\n<li>新增 User 表的一個欄位</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">model User <span class=\"token punctuation\">{</span>\n  id       Int    @id @<span class=\"token keyword\">default</span><span class=\"token punctuation\">(</span><span class=\"token function\">autoincrement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  jobTitle String\n  name     String\n  posts    Post<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"5\">\n<li>執行第二次的 migration</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">prisma migrate dev <span class=\"token operator\">--</span>name added_job_title</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">Applying migration <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">20220803160346_added_job_title</span><span class=\"token template-punctuation string\">`</span></span>\n\nThe following <span class=\"token function\">migration</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> have been created and applied from <span class=\"token keyword\">new</span> <span class=\"token class-name\">schema</span> <span class=\"token literal-property property\">changes</span><span class=\"token operator\">:</span>\n\nmigrations<span class=\"token operator\">/</span>\n  └─ 20220803160346_added_job_title<span class=\"token operator\">/</span>\n    └─ migration<span class=\"token punctuation\">.</span>sql\n\nYour database is now <span class=\"token keyword\">in</span> sync <span class=\"token keyword\">with</span> your schema<span class=\"token punctuation\">.</span></code></pre></div>\n<p>DB 會有個表來呈現並檢查 migration 的過程<code class=\"language-text\">_prisma_migrations</code> 見下圖</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d5d9c80be2c19f0904da6a2f2299b6db/fb937/prisma2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAArElEQVQI1z2NOw6DMBBEOQgYG4QAARLGAREMGPIpkzZ97n+HF9lFitWMdvbNRvv5ZH28MPaO3RzbtjEMhuM4mOcr0zRxnjesXVmWBa0HjDE450LuZ99dYPxN1JgV+/6i7x+6YeJyMZRlSd/3dF1HVdWM4xh827ZIKcnznKZpEEJQ1zVa66BKKSKZCopcIUWMkpKiKEjTNEBZloUCv/PeA0mShCLv4zj+P/Dqsx909lvWaUU5agAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d5d9c80be2c19f0904da6a2f2299b6db/8ac56/prisma2.webp 240w,\n/static/d5d9c80be2c19f0904da6a2f2299b6db/d3be9/prisma2.webp 480w,\n/static/d5d9c80be2c19f0904da6a2f2299b6db/e46b2/prisma2.webp 960w,\n/static/d5d9c80be2c19f0904da6a2f2299b6db/f992d/prisma2.webp 1440w,\n/static/d5d9c80be2c19f0904da6a2f2299b6db/db7e9/prisma2.webp 1820w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d5d9c80be2c19f0904da6a2f2299b6db/8ff5a/prisma2.png 240w,\n/static/d5d9c80be2c19f0904da6a2f2299b6db/e85cb/prisma2.png 480w,\n/static/d5d9c80be2c19f0904da6a2f2299b6db/d9199/prisma2.png 960w,\n/static/d5d9c80be2c19f0904da6a2f2299b6db/07a9c/prisma2.png 1440w,\n/static/d5d9c80be2c19f0904da6a2f2299b6db/fb937/prisma2.png 1820w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d5d9c80be2c19f0904da6a2f2299b6db/d9199/prisma2.png\"\n            alt=\"prisma2\"\n            title=\"prisma2\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"prisma-studio\" style=\"position:relative;\"><a href=\"#prisma-studio\" aria-label=\"prisma studio permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prisma Studio</h3>\n<p>Prisma 有提供可以查看 DB 結構的 GUI 介面，直接執行以下指令。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">npx prisma studio</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8923fa46c27aee864c9d0d3fa452fae3/0ffd9/prisma1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.916666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABLElEQVQY022My07CYBCF+wCW0pb2L7dyaSMQqcWWQqvhkoAICLhg4UZi4saV77/8TAuaxrg4OfPNmTNSx0swrAZmufUrq+ZQEjayYlIoipzOrKgWiiouslDSvVzEKFlIq5d3lvsTy8Mp88Xujc3xg/nmlWiyZTzbE02eGU13xPNDNg/iFcH9mvBhy2C8ZDA7cnf4wt9+Il3fjHB7Q7pejB/NSdnphvjRjH4woePFeOEUfzjLsu5tQpg8Zu72IoJ4gZ+saQdPuOEKSdGqyGoZzbAxK20KaoWCWkZUHco1lzTXTRtdNJCLFopexXY8VMPmShHU232qdge5UEIpCiRdNNGtFqlrZgNdtDJO5zM30bKsSelypxr1zFNOH6fKMquFpOeKP0/znNff/X+9bydUqZ88+c/iAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8923fa46c27aee864c9d0d3fa452fae3/8ac56/prisma1.webp 240w,\n/static/8923fa46c27aee864c9d0d3fa452fae3/d3be9/prisma1.webp 480w,\n/static/8923fa46c27aee864c9d0d3fa452fae3/e46b2/prisma1.webp 960w,\n/static/8923fa46c27aee864c9d0d3fa452fae3/f992d/prisma1.webp 1440w,\n/static/8923fa46c27aee864c9d0d3fa452fae3/882b9/prisma1.webp 1920w,\n/static/8923fa46c27aee864c9d0d3fa452fae3/323b3/prisma1.webp 2558w\"\n              sizes=\"(max-width: 960px) 100vw, 960px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8923fa46c27aee864c9d0d3fa452fae3/8ff5a/prisma1.png 240w,\n/static/8923fa46c27aee864c9d0d3fa452fae3/e85cb/prisma1.png 480w,\n/static/8923fa46c27aee864c9d0d3fa452fae3/d9199/prisma1.png 960w,\n/static/8923fa46c27aee864c9d0d3fa452fae3/07a9c/prisma1.png 1440w,\n/static/8923fa46c27aee864c9d0d3fa452fae3/29114/prisma1.png 1920w,\n/static/8923fa46c27aee864c9d0d3fa452fae3/0ffd9/prisma1.png 2558w\"\n            sizes=\"(max-width: 960px) 100vw, 960px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8923fa46c27aee864c9d0d3fa452fae3/d9199/prisma1.png\"\n            alt=\"prisma1\"\n            title=\"prisma1\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"參考資料\" style=\"position:relative;\"><a href=\"#%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99\" aria-label=\"參考資料 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>參考資料</h3>\n<p><a href=\"https://www.prisma.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Prisma 官網</a></p>\n<p><a href=\"https://www.prisma.io/docs/concepts/database-connectors/mongodb#error-transactions-are-not-supported-by-this-deployment\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">MongoDB database connector</a></p>\n<p><a href=\"https://99designs.com/blog/engineering/schema-driven-development/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Schema-driven development in 2021 - 99designs</a></p>\n<p><a href=\"https://formidable.com/blog/2021/prisma-orm/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">What is Prisma and Why Do We Need Another ORM?</a></p>\n<p><a href=\"https://blog.logrocket.com/code-first-vs-schema-first-development-graphql/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Code-first vs. schema-first development in GraphQL - LogRocket Blog</a></p>","fields":{"slug":"/posts/2023-01-01---Next-generation-ORM-Prisma//posts/2023-01-01---Next-generation-ORM-Prisma","tagSlugs":["/tag/orm/","/tag/prisma/","/tag/web-development/"]},"frontmatter":{"date":"2023-01-01T22:40:32.169Z","description":"經常寫 Node 應用程式的人通常免不了要和 ORM 打交道，畢竟寫原生 SQL 對於大部分的人會比較複雜也或許情境不需要用到這樣的原生操作。ORM 的便利性使得很多情況下我們能直觀而快速地取得資料庫的資料。","tags":["ORM","Prisma","Web Development"],"title":"Next-generation ORM：Prisma","socialImage":null}}},"pageContext":{"slug":"/posts/2023-01-01---Next-generation-ORM-Prisma//posts/2023-01-01---Next-generation-ORM-Prisma"}},"staticQueryHashes":["251939775","2764776372","401334301"]}